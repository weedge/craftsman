version: '1.0'
name: "doraemon-ai-creator-solution-demo"
services: 
  redis:
    image: "redis:alpine"    
    command: redis-server --requirepass ${REDIS_PASSWORD}
    ports:
     - "6379:6379"
    environment:
     - REDIS_REPLICATION_MODE=master
    container_name: ai-creator-redis

  #https://github.com/bitnami/bitnami-docker-redis-cluster/issues/3
  #https://github.com/Grokzen/docker-redis-cluster
  redis-cluster:
    image: grokzen/redis-cluster:latest
    ports:
      - "26379-26384:26379-26384"
    environment:
      - "INITIAL_PORT=26379"
      - "MASTERS=3"
      - "SLAVES_PER_MASTER=1"
      - "SENTINEL=false"
      - "REDIS_CLUSTER_IP=0.0.0.0"
      - "IP=0.0.0.0"
      - "BIND_ADDRESS=0.0.0.0"
    container_name: ai-creator-redis-cluster
  
  app:
    build: .
    image: weedge/ai-creator
    depends_on: 
      - redis
      #- redis-cluster
    ports: 
      - "8123:8123"
    environment:
      NOLIBOX_API_SK: ${NOLIBOX_API_SK}
      NOLIBOX_API_AK: ${NOLIBOX_API_AK}
      REDIS_TYPE: ${REDIS_TYPE}
      REDIS_URL: ${REDIS_URL}
      REDIS_PASSWORD: ${REDIS_PASSWORD}
      REDIS_USERNAME: ${REDIS_USERNAME}
      TEMPLATE_DIR: ${TEMPLATE_DIR}
    container_name: doraemon-ai-creator
